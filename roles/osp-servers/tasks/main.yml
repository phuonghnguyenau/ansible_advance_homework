---

# tasks file for osp.servers
- name: Create new server instances and attaches them a network and passes metadata to the instance
  os_server:
    name: "{{ item.value.name }}"
    cloud: ospcloud
    delete_fip: yes
    flavor: "{{ item.value.flavor }}"
    floating_ip_pools: "{{ osp_floating_ip_network }}"
    image: "{{ item.value.image }}"
    key_name: "{{ item.value.key_name }}"
    meta: "{{ item.value.meta }}"
    nics:
      - net-name: "{{ osp_private_network }}"
    security_groups: "{{ item.value.security_group | list }}"
    state: "{{ item.value.state }}"
    userdata: "{{ osp_userdata }}"
    wait: yes
  loop: "{{ osp_servers | dict2items }}"
